# Data Model: Todo Frontend Application

**Feature**: 003-todo-frontend | **Date**: 2026-02-16
**Purpose**: Define frontend data structures, API contracts, and state shape

## Frontend State Shape

### User State

```typescript
interface User {
  id: string              // UUID from Better Auth
  email: string           // User's email address
  name: string | null     // User's display name (optional)
}

interface AuthState {
  user: User | null       // null when not authenticated
  isLoading: boolean      // true during auth check
  error: string | null    // auth error message
}
```

**Source**: Better Auth JWT payload (`sub` claim contains user ID)

**Validation**: Email format validated on sign-up/sign-in forms

---

### Task State

```typescript
interface Task {
  id: string              // UUID (generated by backend)
  user_id: string         // Owner's user ID (from JWT)
  title: string           // Task title (1-500 chars)
  description: string | null  // Optional description
  status: TaskStatus      // Enum: pending | in-progress | completed | deleted
  priority: TaskPriority  // Enum: low | medium | high
  created_at: string      // ISO 8601 timestamp
  updated_at: string      // ISO 8601 timestamp
}

type TaskStatus = 'pending' | 'in-progress' | 'completed' | 'deleted'
type TaskPriority = 'low' | 'medium' | 'high'

interface TaskListState {
  tasks: Task[]           // All non-deleted tasks for current user
  isLoading: boolean      // true during fetch
  error: string | null    // fetch error message
}
```

**Source**: Backend API `/api/{user_id}/tasks`

**Validation Rules** (from spec):
- Title: required, 1-500 characters, no leading/trailing whitespace
- Description: optional, max 10,000 characters
- Status: must be one of enum values
- Priority: must be one of enum values, defaults to "medium"

---

### Analytics State

```typescript
interface TaskAnalytics {
  statusDistribution: {
    pending: number
    'in-progress': number
    completed: number
  }
  priorityDistribution: {
    low: number
    medium: number
    high: number
  }
  completionTrend: {
    date: string        // ISO date (YYYY-MM-DD)
    completed: number   // Count of tasks completed on this date
  }[]
}
```

**Source**: Computed client-side from task list

**Computation**:
- Status distribution: Count tasks by status (exclude deleted)
- Priority distribution: Count tasks by priority (exclude deleted)
- Completion trend: Group completed tasks by date (last 30 days)

---

## API Contracts

### Authentication Endpoints

#### POST /auth/sign-up

**Request**:
```typescript
interface SignUpRequest {
  name: string            // Required, 1-100 chars
  email: string           // Required, valid email format
  password: string        // Required, min 8 chars
}
```

**Response (Success - 201)**:
```typescript
interface AuthResponse {
  status: 'success'
  token: string           // JWT token (stored in httpOnly cookie by Better Auth)
  user: {
    id: string
    email: string
    name: string
  }
}
```

**Response (Error - 400)**:
```typescript
interface ErrorResponse {
  status: 'error'
  code: 'EMAIL_EXISTS' | 'VALIDATION_ERROR' | 'INVALID_INPUT'
  message: string
  details?: {
    field: string
    message: string
  }[]
}
```

---

#### POST /auth/sign-in

**Request**:
```typescript
interface SignInRequest {
  email: string           // Required, valid email format
  password: string        // Required
}
```

**Response (Success - 200)**:
```typescript
interface AuthResponse {
  status: 'success'
  token: string           // JWT token
  user: {
    id: string
    email: string
    name: string
  }
}
```

**Response (Error - 401)**:
```typescript
interface ErrorResponse {
  status: 'error'
  code: 'INVALID_CREDENTIALS'
  message: 'Invalid email or password'
}
```

---

#### GET /auth/me

**Request**: No body (JWT in cookie)

**Response (Success - 200)**:
```typescript
interface MeResponse {
  id: string
  email: string
  name: string | null
}
```

**Response (Error - 401)**:
```typescript
interface ErrorResponse {
  status: 'error'
  code: 'UNAUTHORIZED'
  message: 'Authentication required'
}
```

---

### Task Endpoints

#### GET /api/{user_id}/tasks

**Request**: No body (JWT in cookie, user_id in path)

**Response (Success - 200)**:
```typescript
interface TaskListResponse {
  status: 'success'
  data: Task[]
  meta: {
    total: number         // Count of tasks returned
  }
}
```

**Response (Error - 403)**:
```typescript
interface ErrorResponse {
  status: 'error'
  code: 'FORBIDDEN'
  message: 'You can only access your own tasks'
}
```

---

#### POST /api/{user_id}/tasks

**Request**:
```typescript
interface TaskCreateRequest {
  title: string           // Required, 1-500 chars
  description?: string    // Optional, max 10,000 chars
  priority?: TaskPriority // Optional, defaults to 'medium'
}
```

**Response (Success - 201)**:
```typescript
interface TaskSingleResponse {
  status: 'success'
  data: Task
  message: 'Task created successfully'
}
```

**Response (Error - 422)**:
```typescript
interface ErrorResponse {
  status: 'error'
  code: 'VALIDATION_ERROR'
  message: 'Request validation failed'
  details: {
    errors: {
      field: string
      message: string
      type: string
    }[]
  }
}
```

---

#### GET /api/{user_id}/tasks/{task_id}

**Request**: No body (JWT in cookie, IDs in path)

**Response (Success - 200)**:
```typescript
interface TaskSingleResponse {
  status: 'success'
  data: Task
}
```

**Response (Error - 404)**:
```typescript
interface ErrorResponse {
  status: 'error'
  code: 'NOT_FOUND'
  message: 'Task not found'
}
```

---

#### PATCH /api/{user_id}/tasks/{task_id}

**Request**:
```typescript
interface TaskUpdateRequest {
  title?: string          // Optional, 1-500 chars
  description?: string    // Optional, max 10,000 chars
  status?: TaskStatus     // Optional
  priority?: TaskPriority // Optional
}
```

**Response (Success - 200)**:
```typescript
interface TaskSingleResponse {
  status: 'success'
  data: Task
  message: 'Task updated successfully'
}
```

**Response (Error - 400)**:
```typescript
interface ErrorResponse {
  status: 'error'
  code: 'INVALID_OPERATION'
  message: 'Cannot update deleted task'
}
```

---

#### DELETE /api/{user_id}/tasks/{task_id}

**Request**: No body (JWT in cookie, IDs in path)

**Response (Success - 200)**:
```typescript
interface DeleteResponse {
  status: 'success'
  message: 'Task deleted successfully'
}
```

**Response (Error - 404)**:
```typescript
interface ErrorResponse {
  status: 'error'
  code: 'NOT_FOUND'
  message: 'Task not found'
}
```

---

## State Management Patterns

### Server Component Data Fetching

```typescript
// app/dashboard/page.tsx (Server Component)
import { fetchTasks } from '@/lib/api/tasks'

export default async function DashboardPage() {
  const tasks = await fetchTasks() // Server-side fetch
  return <TaskList initialTasks={tasks} />
}
```

**Benefits**:
- No client-side loading state needed
- SEO-friendly (rendered on server)
- Faster initial page load

---

### Client Component Optimistic Updates

```typescript
// components/tasks/task-list.tsx (Client Component)
'use client'

export function TaskList({ initialTasks }: { initialTasks: Task[] }) {
  const [tasks, setTasks] = useState(initialTasks)

  async function handleDelete(taskId: string) {
    // Optimistic update
    setTasks(prev => prev.filter(t => t.id !== taskId))

    try {
      await deleteTask(taskId)
    } catch (error) {
      // Rollback on error
      setTasks(initialTasks)
      toast.error('Failed to delete task')
    }
  }
}
```

**Benefits**:
- Instant UI feedback
- Rollback on error
- Better perceived performance

---

## Validation Rules

### Client-Side Validation (UX)

Implemented with React Hook Form + Zod:

```typescript
// lib/schemas/auth.ts
import { z } from 'zod'

export const signUpSchema = z.object({
  name: z.string().min(1, 'Name is required').max(100),
  email: z.string().email('Invalid email format'),
  password: z.string().min(8, 'Password must be at least 8 characters'),
})

export const taskCreateSchema = z.object({
  title: z.string().min(1, 'Title is required').max(500),
  description: z.string().max(10000).optional(),
  priority: z.enum(['low', 'medium', 'high']).default('medium'),
})
```

**Purpose**: Provide immediate feedback before API call

---

### Server-Side Validation (Security)

Backend validates all inputs (already implemented in Phase-2 backend):
- Pydantic models enforce types and constraints
- SQLModel validates database constraints
- Multi-tenancy enforced (user_id filtering)

**Purpose**: Security boundary (never trust client input)

---

## Error Handling Strategy

### API Error Types

```typescript
class APIError extends Error {
  constructor(
    public status: number,
    public code: string,
    public details?: unknown
  ) {
    super(`API Error: ${code}`)
  }
}
```

### Error Display

- **Form errors**: Inline below input fields (red text)
- **API errors**: Toast notifications (top-right corner)
- **Network errors**: Retry button with error message
- **Auth errors**: Redirect to sign-in with message

---

## Data Flow Diagram

```
┌─────────────┐
│   Browser   │
└──────┬──────┘
       │
       │ 1. User action (sign-in, create task)
       ▼
┌─────────────────┐
│ React Component │
└──────┬──────────┘
       │
       │ 2. Call API client
       ▼
┌─────────────────┐
│   API Client    │ (lib/api/*)
│  + Zod Schema   │
└──────┬──────────┘
       │
       │ 3. HTTP request with JWT cookie
       ▼
┌─────────────────┐
│  Backend API    │ (Phase-2/backend)
│  (FastAPI)      │
└──────┬──────────┘
       │
       │ 4. Validate JWT, query database
       ▼
┌─────────────────┐
│   PostgreSQL    │ (Neon)
└──────┬──────────┘
       │
       │ 5. Return data
       ▼
┌─────────────────┐
│   API Client    │
│  (Parse + Validate)
└──────┬──────────┘
       │
       │ 6. Update component state
       ▼
┌─────────────────┐
│ React Component │
│  (Re-render)    │
└─────────────────┘
```

---

## Next Steps

1. Generate TypeScript interfaces in `contracts/` directory
2. Generate Zod schemas in `contracts/` directory
3. Create quickstart.md with setup instructions
4. Update agent context with new technologies
